\chapter{TV Health das Coisas}\label{cap:quatro}

Neste capítulo será descrito a principal contribuição do trabalho. Composto
pelo cenário de utilização da arquitetura TV Health das Coisas, a visão arquitetural 
e a visão de engenharia.

\section{Descrição de cenários}

A figura \ref{fig:cenarios} representa, de maneira genérica, o cenário base
para a aplicação da solução. Nela podem ser verificados três ambientes. O
ambiente A diz respeito ao domicílio do paciente. Já o ambiente B diz respeito
aos atores móveis, tais como, equipe de saúde, parentes, amigos etc. O ambiente
C representa os serviços disponibilizados pela solução.

\figurasimples{cenarios}{Visão geral dos cenários abordados.}{14cm}

\subsection{Ambiente A} \label{subsec:ambiente-a}

O ambiente A representa o domicílio do usuário, seus atores locais (paciente,
visitantes e cuidador e/ou parentes), os equipamentos responsáveis por  realizar
a aquisição dos dados, o \stb[] (\textit{gateway}), a televisão e outros
dispositivos capazes de apresentar dados e informações úteis para a assistência
domiciliar à saúde.

Neste ambiente é possível monitorar constantemente o paciente. Isso é 
proporcionado pelo uso massivo de sensores que nos permite acompanhar com mais clareza 
a situação do doente. A partir do monitoramento é possível alertar à equipe
de saúde (Ambiente B) sobre alguma situação incomum. É possível 
também lembrar ao paciente a necessidade de tomar determinado remédio em um
horário específico.

O cuidador também tem papel importante na recuperação ou no cotidiano do 
paciente. A tecnologia inserida neste ambiente também tem função de ajudar
este ator. O sistema pode enviar mensagens no intuito de auxiliar o cuidador no
que concerne ao tratamento para com o paciente ou idoso. É possível informar 
a melhor maneira de lidar com determinada situação ou simplesmente relembrá-lo 
da agenda diária do paciente.

Os familiares e visitantes, figuras constantes em um ambiente domiciliar, também
podem ser informados sobre um fato novo na agenda do doente, algo inusitado ou 
ainda uma situação de urgência/emergência.

Nesse sentido, podemos inserir no ambiente domiciliar um conjunto de
dispositivos dotados de sensores com o intuito de captar eventos no domicílio. 
Os eventos captados contribuem com informações de contexto para a arquitetura.
É possível a utilização de sistemas para captar os sinais vitais do paciente, tais
como nível de oxigênio no corpo, batimentos cardíacos, temperatura corporal etc.

Outros tipos de sensores podem ser implantados para captar informações do
ambiente, disponibilizando assim informações de contexto para o sistema,  tais
como ruído sonoro nos cômodos, presença dos atores no domicílio, temperatura
ambiente etc. Os sensores de saúde e sensores gerais caracterizam um ambiente 
com tecnologia de Internet das Coisas (\textit{Internet of Things  - IoT}), uma
vez que os dados coletados poderão ser utilizados para análises preditivas.

O STB, equipamento que tinha como principal função o recebimento do sinal
televisivo, seu processamento e a exibição do sinal na tela, ganha novas
funcionalidades a partir do momento em que aumentamos seu  poder de
processamento e o conectamos à Internet. Os dados coletados pelos sensores são,
então, repassados ao STB, que os processa, os apresenta através da tela do
televisor ou ainda através de \smartphones[] conectados ao sistema.

%\subsubsection{Simulações} 

Para exemplificar o ambiente descrito anteriormente, as próximas seções
trazem simulações (situações fictícias) do doente em cenários que a solução
proposta nesta dissertação pode auxiliar.
\label{subsubsec:simulacoes-A}

\subsubsection{Doente sozinho}

Luísa, aposentada, 75 anos, vive sozinha em seu apartamento. Infelizmente,
Luísa sofre de uma doença crônica e seu médico recomenda caminhada uma vez ao
dia, durante 30 minutos.  Além disso, foi prescrito à Luísa alguns medicamentos
necessários para evitar as dores - cada um deles deveria ser ingerido em
horários específicos.

Através do \stb[] acoplado à televisão e conectado à Internet, é
possível enviar à Luísa avisos e notificações lembrando de suas atividades
diárias - como por exemplo, a caminhada de 30 minutos recomendada pelo
médico além do medicamento a ser ingerido.

Através da leitura de sinais vitais, proporcionada pelos sensores médicos,
e conectados ao STB, será possível enviar leituras de sinais vitais específicos 
de Luísa para o médico que a acompanha. Assim, Luísa poderá receber tratamento
diferenciado ou comparecer a uma consulta de maneira antecipada caso seja
detectado a necessidade para tal.

Esta simulação, portanto, exemplifica uma aplicação prática do sistema 
proposto.

\subsubsection{Doente com um familiar}

Roberto é autônomo, trabalha em casa consertando televisores e mora com sua
filha de 16 anos. Apesar do constante contato com os televisores, em seu momento
de descanso, assiste aos seus programas favoritos.

Certo dia, Roberto não se sente bem e se deita. Tendo instalado a sua televisão
o STB com as aplicações da solução proposta ele conta com a disponibilidade de
diversas funcionalidades que podem auxiliá-lo neste momento. Poderá, por
exemplo, acessar uma das aplicação através do controle remoto. A aplicação
apresenta um conjunto de imagens na tela da televisão, cada uma exemplificando
um sintoma.  Usando o controle remoto, ele ou a filha, seleciona os sintomas que melhor
exemplificam o que o doente está sentindo. Essa informação é processada e, em seguida, a
aplicação apresenta uma notificação contendo uma segunda opinião, informando
também a necessidade de se apresentar a um médico. É importante ressaltar que
o sistema não oferece ou indica nenhum tipo de medicamento.

É possível ainda que a aplicação sugira, em determinados casos, procedimentos a
serem realizados no paciente, momento em que a filha de Roberto teria o papel de
cuidadora informal ao realizar tais procedimentos. A aplicação guiaria o
cuidador informal em um processo passo a passo. Nesta simulação,  percebe-se a
importância de contar com um dispositivo que auxilie o cuidador e o paciente em
situações de risco à saúde.

\subsubsection{Doente com um cuidador profissional}

Dona Clélia, aposentada, contratou um cuidador profissional para acompanhar seu
marido, Francisco. Infelizmente, Francisco sofre da doença de Parkinson. Por conta
do seu contrato, o cuidador fica na casa apenas nos horários da manhã e tarde e 
de sobreaviso durante a noite.

Sabendo que o casal de idosos utiliza a solução proposta neste trabalho, e sendo o
cuidador ciente das necessidades do doente, o cuidador poderá receber em seu celular ou
acompanhar através da televisão, um auxílio para a realização de um procedimento inerente
a um paciente com Parkinson, ou ainda, o \textit{status} das atividades diárias.

\subsection{Ambiente B} \label{subsec:ambiente-b}

O ambiente B diz respeito aos atores móveis do cenário geral. Os atores externos
são a equipe de saúde, os familiares e amigos do paciente. Estes três tipos de atores
estão em constante movimento e não visitam o doente frequentemente. Nesse
sentido, o sistema disponibiliza meios para que fiquem a par da situação do
paciente.

Estando os atores com um \smartphone[] e este dispositivo conectado ao
sistema, é possível receber alertas relacionados ao paciente. Os alertas podem
envolver desde o \textit{status} atual do doente, considerações acerca do
cuidador até mensagens de cunho emergencial.

Já através da interface \web[], os atores mais beneficiados são a equipe de
saúde e os familiares, pois eles têm acesso a informações mais detalhadas do
paciente através desta forma de visualização de dados. Nesse modelo, os dados
apresentados vão desde a leitura de alguns sensores instalados na casa até a
visualização de sinais vitais do paciente.

\subsubsection{Doente em situação de emergência}

Maria é dona de casa e passa suas manhãs organizando e limpando a casa. Apesar
de todo esse apreço pela casa, Maria não se cuida e, além de ser hipertensa,
esquece de tomar seu remédio em algumas ocasiões.

Certa manhã, após preparar o almoço, Maria senta-se para assistir televisão -
que conta com o STB com a solução proposta. Passado alguns minutos, ela sente
uma forte dor no peito seguido por um desconforto no braço esquerdo. Neste
momento, Maria certa de que precisa de ajuda, pode acionar no controle remoto o
``botão de pânico''. 

A aplicação percebe o acionamento e toma algumas medidas, tais como, enviar
mensagens de socorro através de SMS ou através de serviços de mensagens pela
Internet para a equipe de saúde, para os amigos e familiares.  Por fim, a
aplicação pode enviar uma notificação para ser exibida na televisão no sentido
de tranquilizar o usuário.

Além disso, os sensores de saúde utilizados por Maria auxiliam os atores
externos (equipe de saúde, familiares e amigos) a tomarem as medidas
necessárias para o melhor atendimento de Maria.  Em determinados casos, é
possível, ainda, que a aplicação envie, através de notificações, sugestões de
medidas a serem tomadas enquanto o socorro médico não chega.

\subsection{Ambiente C} \label{subsec:ambiente-c}

O ambiente C aborda de forma geral os serviços oferecidos e de que forma eles se
relacionam com a parte A e B. Podemos descrever a parte C a partir de uma leitura 
\textit{bottom-up} da figura \ref{fig:cenarios}. 

No subitem Z pautamos a Internet das Coisas ou \textit{IoT} e o \textit{hub}. A
partir desses dois blocos será possível realizar a aquisição de dados dos sensores
de saúde conectados ao paciente e sensores instalados no domicílio (ambiente A).
Isso proporciona um monitoramento constante dos atores envolvidos, o que é ideal
para uma situação de assistência domiciliar. Este serviço fará uso de tópicos
apresentados na plataforma \textit{OpenIoT} (seção \vref{sec:openiot}).

O subitem Y representa o bloco em que é feita a integração dos dados adquiridos
à plataforma \nextsaude[] (subitem X). Para isso, utiliza-se o padrão OpenEHR. Sua 
função é permitir que outros sistemas de saúde se comuniquem de maneira transparente 
e com o menor esforço técnico possível.

%Parte dessa integração é realizada através do padrão OpenEHR (subitem Y), sua 
%função é permitir que sistemas informatizados de saúde, no caso a plataforma
%\nextsaude[], se comunique de maneira transparente com outros sistemas de saúde ou
%instâncias de sistemas de saúde, tal como a aplicação TV-Health (descrito no capítulo
%\ref{cap:aspectos-de-implementacao}). A utilização do OpenEHR possibilita que toda a solução
%proposta se comunique, com o menor esforço possível, com outros sistemas de 
%saúde.

No subitem X temos a plataforma \nextsaude[]. Esta plataforma oferece meios
para que outros sistemas possam se comunicar com ela, possibilitando uma
integração entre vários sistemas. Além disso, é através da plataforma que o
sistema tem acesso aos serviços de farmácia, regulação, leitos, entre outros
descritos na pesquisa de \citeonline{mota2016}.

\section{Descrição da arquitetura}
\label{sec:descricao-solucao}

A arquitetura TV Health das Coisas proposta nesta seção tem como uma das bases
a plataforma OpenIoT (descrita na seção \vref{sec:openiot}). Considerando a
forma em que ela foi dividida - ``Plano Físico'', ``Plano Virtualizado'' e
``Plano de Utilitários e Aplicativos'' - foi feito um estudo para entender de
que forma ela poderia ser modificada e utilizada para atender o ambiente de
assistência domiciliar à saúde.

%Levando em consideração a divisão da
%arquitetura nas 3 grandes camadas , re-estruturamos para suprir a
%necessidade específica do trabalho. Uma arquitetura que atenda a ambientes de
%assistência domiciliar à saúde e que tenha em sua estrutura, espaço para a
%tecnologia IoT.

Na figura \ref{fig:arquitetura-openiot-2} foi separado o Plano físico -
composto principalmente pelo módulo \textit{Global Sensor Network} -
em 2 blocos e uma camada de nome ``Aquisição de dados'' (figura
\ref{fig:arquitetura-passo1}). Esta camada caracteriza toda a parte de baixo
nível da arquitetura. Fazem parte dela os sensores de saúde, sensores gerais, o
\stb[] e suas aplicações embarcadas. A comunicação entre esses dois blocos
dar-se através da rede WiFi disponibilizada na residência ou Bluetooth. Os
dados adquiridos são persistidos no STB. Caso seja necessário, alguns desses
dados são repassados adiante para posterior processamento. 

\figurasimples{arquitetura-passo1}{Simplificação da arquitetura OpenIoT - Plano Físico}{10cm}

Considerando a figura \ref{fig:arquitetura-openiot-2}, foi separado o Plano
Virtualizado em 3 blocos e 3 camadas distintas, como pode ser visto na figura
\ref{fig:arquitetura-passo2}. 

\figurasimples{arquitetura-passo2}{Simplificação da arquitetura OpenIoT - Plano Virtualizado}{10cm}

A ``Camada de inteligência local'' não tem representante equivalente na
arquitetura OpenIoT e pode ser relacionada tanto com o Plano Físico, quanto com
o Plano Virtualizado. Ela encontra-se virtualmente no dispositivo
STB mas tem características próprias dos módulos do Plano Virtualizado.
Essa abordagem resulta em aplicações embarcadas que têm capacidade de inferir sobre
determinadas situações. Dados provenientes dos sensores e que são úteis para a
conclusão de um fato são utilizados como entrada para domínios de conhecimento
na forma de ontologias. O próprio STB, portanto, pode decidir em eventuais
situações, fornecendo uma resposta rápida e evitando assim, tráfego de dados
desnecessário através da Internet.

Já a ``Camada de inteligência remota'' baseia-se no Plano Virtualizado que
é composto pelos módulos ``\textit{Scheduler}'', ``\textit{Linked Stream Middleware}'' e ``\textit{Service
Delivery and Utility Manager}''. A camada tem como função recuperar os dados
adquiridos pelos sensores e processá-los através de classificadores.
Ao transmitir dados do ambiente domiciliar para o sistema na nuvem, a solução incorpora o 
poder de processamento disponibilizado por essa abordagem. Além de realizar inferências
através de ontologias, a camada utiliza inteligência artificial
por meio de aprendizagem de máquinas para aumentar o poder de inferência do
sistema.

A ``Camada de gerência de dados'' foi extraída do Plano Virtualizado e do
Plano de Utilitários e Aplicativos. Ela trata os dados gerenciais, aqueles
referentes ao paciente e a logística de um atendimento especializado em
domicílio. Além disso, realiza a integração com o ambiente hospitalar, caso
seja necessário uma transferência do doente. A plataforma \nextsaude[]
é utilizada nesta camada para prover os serviços necessários, tais como, o 
Registro Eletrônico de Saúde (RES), integração com áreas hospitalares, farmácias etc.

\figurasimples{arquitetura-passo3}{Simplificação da arquitetura OpenIoT - Plano de Utilitários e Aplicações}{10cm}

Por fim, a ``Camada de apresentação'' é referente ao Plano de Utilitários e
Aplicativos, porém, diferente da plataforma OpenIoT, esta camada se estende por
toda a arquitetura, uma vez que a visualização de dados está presente em todas 
as camadas. Sendo assim, é possível que os diversos atores interajam por meio de
\smartphones, computadores e a tela da televisão na casa do doente.
A camada, portanto, se encarrega de apresentar os dados brutos ou as informações
processadas nos dispositivos conectados à plataforma. 

A arquitetura TV Health das Coisas é, portanto, composta de 5 camadas distintas mas que se comunicam
entre si. A ``Camada de aquisição de
dados'' responsável por adquirir os dados brutos dos sensores, ``Camada de
Inteligência local'' responsável por inferir sob os dados ainda no
STB, ``Camada de Inteligência na nuvem'', responsável por realizar
inferências que não podiam ser realizadas localmente, ``Camada de Gerência
de dados'', responsável por gerenciar parte dos dados coletados no ambiente
domiciliar e ``Camada de Apresentação de informações'' - responsável por
apresentar os dados nos mais diversos dispositivos, são representadas na figura
\ref{fig:arquitetura-final}.

\figurasimples{arquitetura-final}{Visão geral arquitetural TV Health das Coisas}{12cm}

\section{Visão de Engenharia} \label{sec:visao-engenharia}

A figura \ref{fig:visao-engenharia-final} representa a visão de engenharia da arquitetura
TV Health das Coisas. Ela tem como ponto principal a utilização de um \stb[]. Se
conectam a ele sensores implantados no ambiente, sensores de dispositivos como
\smartphones[] e  \smartwatches[] do paciente e do cuidador, e sensores de saúde 
do doente.

Esse processo é composto de três momentos distintos, mas interligados, no qual
o primeiro é relativo à aquisição de dados do ambiente e do paciente, e a
transmissão destes dados ao STB. O segundo diz respeito ao processamento dos
dados brutos. O terceiro momento o envio dos dados processados para a plataforma
\nextsaude[].

\figurasimples{visao-engenharia-final}{Visão de engenharia da arquitetura TV Health das Coisas.}{12cm}

\subsection{Blocos \textit{hub} e sensores}

Os sensores gerais, relativos ao ambiente domiciliar, coletam
informações como  temperatura e umidade da residência, qualidade do ar e
localização do paciente ou cuidador nos cômodos. A partir desses dados é
possível dizer ao software se determinado espaço está muito quente, se a
qualidade do ar não está favorável à melhoria do paciente etc. Dados extraídos
de celulares, como a localização, também cooperam com o contexto, a exemplo da
informação proveniente do celular do cuidador que informa, à equipe de saúde ou
aos parentes, se este está junto ao paciente.

Já os sensores de saúde têm como função principal coletar os sinais vitais do
paciente (pressão arterial, frequência cardíaca, níveis de oxigênio no sangue
etc). Em ambos os casos, - sensores gerais e sensores de saúde - as informações
coletadas pelos dispositivos repassam  esses dados para o STB através de
interfaces com tecnologia  \textit{Bluetooth} ou \textit{WiFi}.

Na utilização de sensores com WiFi, por exemplo, os dados são transferidos ao
STB através de um protocolo de transferência de mensagens entre máquinas, o
MQTT\footnote{O MQTT é um protocolo de transferência de mensagens de baixo
custo computacional e reside em cima da camada TCP/IP. O sistema funciona a
partir de um \textit{publish/subscriber}. Utiliza-se um concentrador como um
servidor MQTT.}.  Foi instalado no STB um servidor MQTT para gerenciar os dados
de entrada.

\subsection{Bloco inferência local}

Para que o sistema de inferência local funcione de maneira adequada, é
necessário basicamente a base de conhecimentos, composta por ontologias de
domínios, ontologias de aplicação e regras de inferência. 

Além disso, os dados provenientes da camada de aquisição de dados devem ser
tratados para que sirvam de entrada para o sistema de inferência. Sendo assim,
o STB pode tomar decisões no âmbito domiciliar, não necessitando de acesso
à Internet para inferir sobre determinada situação.

\subsection{Bloco aprendizagem de máquinas}

O bloco de aprendizagem de máquinas que pertence a camada de inferência remota
recebe os sinais vitais do paciente através da camada de aquisição de
dados. Em seguida os dados são processados para que sejam extraídos os atributos,
compondo um conjunto de dados específicos. Por fim, algoritmos de aprendizagem
de máquinas são executados, inferindo sobre determinado assunto.

Pesquisas realizadas por \citeonline{mario2016} utilizam aprendizagem de
máquinas para auxiliar no cuidado a grávidas. Já a pesquisa de
\citeonline{bragamobile} faz uso de classificadores preditivos para identificar a
presença de doenças transmissíveis pelo mosquito \textit{Aedes Aegypti} a partir
de um conjunto de dados. Ambas as pesquisas foram realizadas por pesquisadores 
do projeto \nextsaude[] no âmbito do laboratório LAR.

\subsection{Bloco plataforma \nextsaude}

O bloco plataforma \nextsaude[] compõe a camada de gerência de dados e abriga
o sistema responsável pela interligação da TV Health das Coisas com outros sistemas
do projeto \nextsaude[] (figura \ref{fig:projeto-nextsaude}).

\figuraadaptada[mota2016]{projeto-nextsaude}{Interação da TV Health das Coisas com outros módulos
do projeto \nextsaude.}{12cm}

A camada de aquisição de dados se comunica com este bloco através de uma
arquitetura cliente/servidor em que mensagens encapsuladas com o padrão
de interoperabilidade OpenEHR trafegam, alimentando o Registro Eletrônicos
de Saúde (RES) do paciente. Na plataforma, as informações do paciente são
persistidas e podem ser cruzadas com outros sistemas que compõem o projeto
\nextsaude[] e com outros módulos, tais como: farmácia e internação.
Dessa maneira é possível, por exemplo, indicar uma consulta na especialidade
cardiológica para um paciente em situação de ADS.

%O restante de dados enviada ao STB deverá então ser processada e encaminhada
%para a plataforma \nextsaude[] e para a camada de inferência remota.  O
%processamento é referente ao tratamento do dado bruto recebido e a tradução
%para o padrão de interoperabilidade OpenEHR entendido pela plataforma \nextsaude[]. Em seguida a
%transmissão dos dados é feita através de uma arquitetura  cliente/servidor. Já
%no sistema na nuvem, o dado relacionado ao paciente é extraído e persistido.

%A partir da lógica de transferência de dados e informações, persistência
%dos dados, inferência local ou na nuvem, é possível a geração de alertas e
%notificações para o paciente e o cuidador. 

Por fim, os atores locais (paciente/cuidador) recebem as notificações
principalmente através da tela da televisão conectada ao STB e através do
\smartphone. Os atores móveis (equipe de saúde) podem visualizar os dados e
receber informações referentes ao paciente a partir da interface \web[] ou a
partir do \smartphone.


%Os dados referentes aos sinais vitais são enviados para
%plataforma \nextsaude. Dessa maneira, ocorre um processamento nos dados para tomada de
%decisões a nível clínico, por exemplo, indicar uma consulta na especialidade
%cardiológica.


