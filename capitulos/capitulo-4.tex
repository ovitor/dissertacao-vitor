\chapter{Proposta}\label{cap:proposta}

Neste capítulo serão abordadas as etapas que constituem a estrutura geral do
sistema de informática voltado para o atendimento de paciente no espaço domiciliar. 
Na primeira seção são apresentados o cenário e situações do cotidiano exemplificando
o uso da solução. Em seguida, a descrição da arquitetura é exposta. Por fim, uma
visão de engenharia é descrita.

\section{Descrição de cenários}

A figura \ref{fig:cenarios} representa, de maneira generalista, o cenário base
para a aplicação da solução THECA. Nela podem ser verificados três ambientes. O
ambiente A diz respeito ao domicílio do paciente. Já o ambiente B diz respeito
aos atores móveis, tais como, equipe de saúde, parentes, amigos etc. O ambiente
C representa os serviços disponibilizados pela solução.

\figurasimples{cenarios}{Visão geral dos cenários abordados.}{14cm}

\subsection{Ambiente A} \label{subsec:ambiente-a}

O ambiente A representa o domicílio do usuário, seus atores locais (paciente,
visitantes e cuidador e/ou parentes), os equipamentos responsáveis por  realizar
a aquisição dos dados, o \stb[] (\textit{gateway}), a televisão e outros
dispositivos capazes de apresentar dados e informações úteis para a assistência
domiciliar à saúde.

Neste ambiente, o ator principal é o paciente, o monitoramento constante 
proporcionado pela tecnologia nos permite acompanhar com mais clareza a situação
do doente. A partir do monitoramento é possível avisar, por exemplo, à equipe
de saúde (Ambiente B) uma leitura de sinais vitais. Nesse sentido, é possível 
também lembrar ao paciente a necessidade de tomar determinado remédio em um
horário específico.

O cuidador também tem papel importante na recuperação ou no cotidiano do 
paciente. A tecnologia, portanto, inserida neste ambiente tem função de ajudar
este ator. O sistema pode enviar mensagens no intuito de auxiliar o cuidador no
que concerne ao tratamento para com o paciente ou idoso, informando como lidar
com determinada situação ou simplesmente relembrá-lo da agenda diária do 
paciente, como por exemplo atividade física, encontro com amigos etc.

Os familiares e visitantes, figuras constantes em um ambiente domiciliar, também
podem ser informados sobre um fato novo na agenda do doente, algo inusitado ou 
ainda uma situação de urgência/emergência.

Nesse sentido, podemos inserir no ambiente domiciliar um conjunto de
dispositivos dotados de sensores com o intuito de captar eventos no domicílio. É
possível a utilização de sistemas para captar os sinais vitais do paciente, tais
como nível de oxigênio no corpo, batimentos cardíacos, temperatura corporal etc.
Outros tipos de sensores podem ser implantados para captar informações do
ambiente, disponibilizando assim informações de contexto para o sistema,  tais
como ruído sonoro nos cômodos, presença dos atores no domicílio, temperatura
ambiente etc. Estas duas categorias caracterizam um  ambiente com tecnologia de
Internet das Coisas (\textit{Internet of Things  - IoT}).

O STB, equipamento que tinha como principal função o recebimento do sinal
televisivo, seu processamento e  exibição, ganha novas funcionalidades a partir
do momento em que aumentamos seu  poder de processamento e o conectamos à 
Internet. Os dados coletados pelos sensores são, então, repassados ao STB,
que os processa, os apresenta através da tela do televisor ou ainda através de
\smartphones[] conectados ao sistema.

\subsection{Ambiente B} \label{subsec:ambiente-b}

O ambiente B diz respeito aos atores móveis do cenário geral. Os atores externos
são a equipe de saúde, os familiares e amigos do paciente. Estes três atores
estão em constante movimento e não visitam o doente frequentemente. Nesse
sentido, o sistema disponibiliza meios para que fiquem a par da situação do
paciente.

Estando os atores de porte de um \smartphone[] e este dispositivo conectado ao
sistema, é possível receber alertas relacionados ao paciente. Os alertas podem
envolver desde o \textit{status} atual do doente, considerações acerca do
cuidador até mensagens de cunho emergencial.

Já através da interface \web[], os atores mais beneficiados são a equipe de
saúde e os familiares, pois eles têm acesso a informações mais detalhadas do
paciente através desta forma de visualização de dados. Nesse modelo, os dados
apresentados vão desde a leitura de sensores instalados na casa até a
visualização de sinais vitais do paciente.

\subsection{Ambiente C} \label{subsec:ambiente-c}

O ambiente C aborda de forma geral os serviços oferecidos e de que forma eles se
relacionam com a parte A e B. Podemos descrever a parte C a partir de uma leitura 
\textit{top-down} da figura \ref{fig:cenarios}. No subitem X temos a plataforma
NextSAÚDE, esta plataforma oferece meios de comunicação para que outros sistemas
possam se comunicar com ela, possibilitando uma integração entre vários sistemas.

Parte dessa integração é realizada através do padrão OpenEHR (subitem Y), sua 
função é permitir que sistemas informatizados de saúde, no caso a plataforma
NextSAÚDE, se comunique de maneira transparente com outros sistemas de saúde ou
instâncias de sistemas de saúde, tal como a aplicação TV-Health (seção
\vref{sec:tv-health}). A utilização do OpenEHR possibilita que toda a solução
proposta se comunique, com o menor esforço possível, com outros sistemas de 
saúde.

Na última camada da pilha - no subitem Z - pautamos a Internet das Coisas ou
\textit{IoT}. A partir deste conceito será possível realizar a aquisição de
dados dos sensores médicos conectados ao paciente e sensores instalados no domicílio
(ambiente A), proporcionando um monitoramento constante dos atores envolvidos, 
o que é ideal para uma situação de internação domiciliar. Este serviço fará uso 
de tópicos apresentados na plataforma \textit{OpenIoT}
(seção \vref{subsec:openiot}).

\subsection{Simulações} \label{subsec:simulacoes}

No sentido de exemplificar os ambientes descritos anteriormente, esta subseção
traz simulações (situações fictícias) do doente em cenários que a solução
proposta nesta dissertação pode auxiliar. As três primeiras subseções 
(\nameref{subsubsec:doente-sozinho}, \nameref{subsubsec:doente-com-familiar}
e \nameref{subsubsec:doente-cuidador}) remetem ao \nameref{subsec:ambiente-a}.
Já a simulação \nameref{subsubsec:doente-emergencia} remete ao \nameref{subsec:ambiente-b}.

\subsubsection{Doente sozinho} \label{subsubsec:doente-sozinho}

Luisa, aposentada, 75 anos, vive sozinha em seu apartamento. Quando não está
realizando refeições e lavando pratos, passa boa parte do seu dia na sala de
estar, lendo ou assistindo à televisão. Infelizmente, Luisa sofre de uma doença 
crônica e seu médico recomenda caminhada uma vez ao dia, durante 30 minutos. 
Além disso, foi prescrito à Luisa alguns medicamentos necessários para evitar 
as dores - cada um deles deveria ser ingerido em horários específicos.

Através do \stb[] acoplado à televisão e conectado à Internet, é
possível enviar à Luisa avisos e notificações lembrando de suas atividades
diárias - como por exemplo, a caminhada de 30 minutos recomendada pelo
médico além do medicamento a ser ingerido.

Através da leitura de sinais vitais, proporcionada pelos sensores médicos,
e conectados ao STB, será possível enviar leituras de sinais vitais específicos 
de Luisa para o médico que a acompanha. Assim, Luisa poderá receber tratamento
diferenciado ou comparecer a uma consulta de maneira antecipada caso seja
detectado a necessidade para tal.

Portanto, esta simulação de uso exemplifica uma aplicação prática do sistema 
proposto.

%Para que Luisa não ficasse sozinha tanto tempo, seus filhos pediram à vizinha
%que checasse sua condição de tempos em tempos, fazendo com que Luisa agora tivesse uma
%espécie de cuidador informal. A função do cuidador informal seria de acompanhar
%Luisa na caminhada e recordá-la de tomar seus remédios.

\subsubsection{Doente com um familiar} \label{subsubsec:doente-com-familiar}

Roberto é autônomo, trabalha em casa consertando televisores e mora com sua
filha de 16 anos. Apesar do constante contato com os televisores, em seu momento
de descanso, assiste aos seus programas favoritos.

Certo dia, Roberto não sente-se bem e deita-se, tendo instalado à sua televisão
o STB com as aplicações da solução proposta, ele conta com a disponibilidade de
diversas funcionalidades que podem auxiliá-lo neste momento. Poderá, por
exemplo, acessar uma das aplicação através do controle remoto, a aplicação
apresenta um conjunto de imagens na tela da televisão, cada uma exemplificando
um sintoma.  Usando o controle remoto, seleciona os sintomas que melhor
exemplificam o que está sentindo. Essa informação é processada e, em seguida, a
aplicação apresenta uma notificação contendo uma segunda opinião, informando
também a necessidade de se apresentar a um médico.

É possível ainda que a aplicação sugira, em determinados casos, procedimentos a
serem realizados no paciente, momento em que a filha de Roberto teria o papel de
cuidadora informal ao realizar tais procedimentos. A aplicação guiaria o
cuidador informal em um processo passo a passo. Nesta simulação,  percebe-se a
importância de contar com um dispositivo que auxilie o cuidador e o paciente em
situações de risco à saúde.

\subsubsection{Doente com um cuidador profissional} \label{subsubsec:doente-cuidador}

Dona Clélia, aposentada, contratou um cuidador profissional para acompanhar seu
marido Francisco. Infelizmente, Francisco sofre da doença de Parkinson. Por conta
do seu contrato, o cuidador fica na casa apenas nos horários da manhã e tarde.

Sabendo que o casal de idosos utiliza a solução proposta neste trabalho, e sendo o
cuidador ciente das necessidades do doente, o cuidador poderá receber em seu celular ou
acompanhar através da televisão auxílio para a realização de um procedimento inerente
a um paciente com Parkinson, ou ainda, o \textit{status} das atividades diárias.

\subsubsection{Doente em situação de emergência} \label{subsubsec:doente-emergencia}

Maria é dona de casa e passa suas manhãs organizando e limpando a casa. Apesar
de todo esse apreço pela casa, Maria não se cuida e, além de ser hipertensa,
esquece de tomar seu remédio em algumas ocasiões, tamanho é o seu desleixo.

Certa manhã, após preparar o almoço, Maria senta-se para assistir televisão -
que conta com o STB com a solução proposta. Passado alguns minutos, ela sente
uma forte dor no peito seguido por um desconforto no braço esquerdo. Neste
momento, Maria certa de que precisa de ajuda, pode acionar no controle remoto o
"botão de pânico". 

A aplicação percebe o acionamento e toma algumas medidas, tais como, enviar
mensagens de socorro através de SMS ou através de serviços de mensagens pela
Internet para a equipe de saúde, para os amigos e familiares.  Por fim, a
aplicação pode enviar uma notificação para ser exibida na televisão no sentido
de tranquilizar o usuário.

Além disso, os sensores médicos utilizados por Maria auxiliam os atores
externos (equipe de saúde, familiares e amigos) a tomarem as medidas
necessárias para o melhor atendimento de Maria.  Em determinados casos, é
possível, ainda, que a aplicação envie, através de notificações, sugestões de
medidas a serem tomadas enquanto o socorro médico não chega.

\section{Descrição da solução}
\label{sec:descricao-solucao}

A arquitetura proposta soluciona o problema relatado na seção 
\vref{sec:descricao-problema}. Ela é composta de 3 camadas distintas mas que
se comunicam entre sí. As camadas são, (1) ``Camada de aquisição de dados''
responsável por adquirir os dados brutos dos sensores, (2) ``Camada de Gerência 
e Inteligência'' responsável por tratar os dados e inferir e (3) ``Camada de 
Apresentação de informações'' - responsável por apresentar os dados nos mais
diversos dispositivos. A figura \ref{fig:arquitetura-v2} representa graficamente
a arquitetura proposta.

\figurasimples{arquitetura-v2}{Visão geral arquitetural da solução}{12cm}

A ``Camada de aquisição de dados'' representa toda a parte de baixo nível da
solução.

Já a ``Camada de Gerência e Inferência'' trata os dados processados na camada
de aquisição de dados, realizando inferências com modelos ontológicos e 
persistindo-os em base de dados.

Por fim, a ``Camada de apresentação'' se encarrega de apresentar os dados brutos
ou as informações processadas nos dispositivos conectados à plataforma.

% \figurasimples{tela-principal-dado}
% {Tela principal do módulo \textit{service.dado}}{14cm}

% % \figurasimples{notificacao-botao-de-panico}
% {Mensagem na tela tranquilizando o usuário.}{14cm}

\section{Visão de Engenharia} \label{sec:visao-engenharia}

A figura \ref{fig:arquitetura} representa a visão de engenharia da arquitetura
proposta. Ela tem como ponto principal a utilização de um \stb[], quando se
conectam a ele sensores  implantados no ambiente, sensores de dispositivos como
\smartphones[] e  \smartwatches[] do paciente e do cuidador, e sensores médicos
do doente.

\figurasimples{arquitetura}{Visão de engenharia da arquitetura proposta.}{12cm}

Esse processo é composto de três momentos distintos, mas  interligados, no qual
o primeiro é relativo à aquisição de dados do ambiente e do paciente, e a
transmissão desses dados ao STB. O segundo diz respeito ao processamento dos
dados brutos. O terceiro momento o envio dos dados processados para a plataforma
NextSAÚDE.

Neste sentido, os sensores gerais, relativos ao ambiente domiciliar, coletam
informações como  temperatura e umidade da residência, qualidade do ar e
localização do paciente ou cuidador nos cômodos. A partir desses dados é
possível dizer ao software se determinado espaço está muito quente, se a
qualidade do ar não está favorável à melhoria do paciente etc. Dados extraídos
de celulares, como a localização, também cooperam com o contexto, a exemplo da
informação proveniente do celular do cuidador que informa, à equipe médica ou
aos parentes, se este está junto ao paciente.

Já os sensores médicos têm como função principal coletar os sinais vitais do
paciente (pressão arterial, frequência cardíaca, níveis de oxigênio no sangue
etc). Em ambos os casos - sensores gerais e sensores médicos -, as informações
coletadas pelos dispositivos repassam  esses dados para o STB, seja através de
interfaces com tecnologia  \textit{Bluetooth}, \textit{NFC} ou \textit{Wi-Fi}.

Essa quantidade de dados enviada ao STB deverá então ser processada e encaminhada
para a plataforma NextSaúde. O processamento é referente ao tratamento do dado
bruto recebido e a tradução para o padrão OpenEHR entendido pela plataforma
NextSaúde. Em seguida a transmissão dos dados é feita através de uma
arquitetura  cliente/servidor. Já no sistema na nuvem, o dado relacionado ao
paciente é extraído e persistido.

Para permitir ao STB tomar decisões no âmbito domiciliar, parte dos dados
referentes ao contexto são tratados e processados diretamente no equipamento.
Já os dados referentes aos sinais vitais são enviados para plataforma. Dessa 
maneira, ocorre um processamento nos dados para tomada de decisões a nível
clínico, por exemplo, indicar uma consulta na especialidade cardiológica.

Pelo exposto, uma funcionalidade importante do sistema é a geração de alertas e
notificações para o paciente e o cuidador. Os atores recebem as notificações
através da tela da televisão conectada ao STB. Para esse sistema, dois tipos de
alertas foram desenvolvidos: o tipo \textit{pop-up} e o caixa de diálogo.
Além disso, a partir das informações de contexto, o sistema pode decidir
entregar a mensagem não na tela da televisão e sim no \smartphone.

