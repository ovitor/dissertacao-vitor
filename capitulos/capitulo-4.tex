\chapter{Proposta}\label{cap:quatro}

Neste capítulo serão abordadas as etapas que constituem a estrutura geral do
sistema de informática voltado para o atendimento de paciente no espaço domiciliar. 
Na primeira seção são apresentados o cenário e situações do cotidiano exemplificando
o uso da solução. Em seguida, a descrição da arquitetura é exposta. Por fim, uma
visão de engenharia é descrita.

\section{Descrição de cenários}

A figura \ref{fig:cenarios} representa, de maneira generalista, o cenário base
para a aplicação da solução. Nela podem ser verificados três ambientes. O
ambiente A diz respeito ao domicílio do paciente. Já o ambiente B diz respeito
aos atores móveis, tais como, equipe de saúde, parentes, amigos etc. O ambiente
C representa os serviços disponibilizados pela solução.

\figurasimples{cenarios}{Visão geral dos cenários abordados.}{14cm}

\subsection{Ambiente A} \label{subsec:ambiente-a}

O ambiente A representa o domicílio do usuário, seus atores locais (paciente,
visitantes e cuidador e/ou parentes), os equipamentos responsáveis por  realizar
a aquisição dos dados, o \stb[] (\textit{gateway}), a televisão e outros
dispositivos capazes de apresentar dados e informações úteis para a assistência
domiciliar à saúde.

Neste ambiente, o ator principal é o paciente, o monitoramento constante 
proporcionado pela tecnologia nos permite acompanhar com mais clareza a situação
do doente. A partir do monitoramento é possível avisar, por exemplo, à equipe
de saúde (Ambiente B) uma leitura de sinais vitais. Nesse sentido, é possível 
também lembrar ao paciente a necessidade de tomar determinado remédio em um
horário específico.

O cuidador também tem papel importante na recuperação ou no cotidiano do 
paciente. A tecnologia, portanto, inserida neste ambiente tem função de ajudar
este ator. O sistema pode enviar mensagens no intuito de auxiliar o cuidador no
que concerne ao tratamento para com o paciente ou idoso, informando como lidar
com determinada situação ou simplesmente relembrá-lo da agenda diária do 
paciente, como por exemplo atividade física, encontro com amigos etc.

Os familiares e visitantes, figuras constantes em um ambiente domiciliar, também
podem ser informados sobre um fato novo na agenda do doente, algo inusitado ou 
ainda uma situação de urgência/emergência.

Nesse sentido, podemos inserir no ambiente domiciliar um conjunto de
dispositivos dotados de sensores com o intuito de captar eventos no domicílio. É
possível a utilização de sistemas para captar os sinais vitais do paciente, tais
como nível de oxigênio no corpo, batimentos cardíacos, temperatura corporal etc.
Outros tipos de sensores podem ser implantados para captar informações do
ambiente, disponibilizando assim informações de contexto para o sistema,  tais
como ruído sonoro nos cômodos, presença dos atores no domicílio, temperatura
ambiente etc. Os sensores médicos e sensores gerais caracterizam um  ambiente 
com tecnologia de Internet das Coisas (\textit{Internet of Things  - IoT}), uma
vez que os dados coletados poderão ser utilizados para análises preditivas.

O STB, equipamento que tinha como principal função o recebimento do sinal
televisivo, seu processamento e a exibição do sinal na tela, ganha novas
funcionalidades a partir do momento em que aumentamos seu  poder de
processamento e o conectamos à Internet. Os dados coletados pelos sensores são,
então, repassados ao STB, que os processa, os apresenta através da tela do
televisor ou ainda através de \smartphones[] conectados ao sistema.

\subsubsection{Simulações} \label{subsubsec:simulacoes-A}

No sentido de exemplificar o ambiente descrito anteriormente, esta subseção
traz simulações (situações fictícias) do doente em cenários que a solução
proposta nesta dissertação pode auxiliar.

\subparagraph{Doente sozinho}

Luísa, aposentada, 75 anos, vive sozinha em seu apartamento. Quando não está
realizando refeições e lavando pratos, passa boa parte do seu dia na sala de
estar, lendo ou assistindo à televisão. Infelizmente, Luísa sofre de uma doença 
crônica e seu médico recomenda caminhada uma vez ao dia, durante 30 minutos. 
Além disso, foi prescrito à Luísa alguns medicamentos necessários para evitar 
as dores - cada um deles deveria ser ingerido em horários específicos.

Através do \stb[] acoplado à televisão e conectado à Internet, é
possível enviar à Luísa avisos e notificações lembrando de suas atividades
diárias - como por exemplo, a caminhada de 30 minutos recomendada pelo
médico além do medicamento a ser ingerido.

Através da leitura de sinais vitais, proporcionada pelos sensores médicos,
e conectados ao STB, será possível enviar leituras de sinais vitais específicos 
de Luísa para o médico que a acompanha. Assim, Luísa poderá receber tratamento
diferenciado ou comparecer a uma consulta de maneira antecipada caso seja
detectado a necessidade para tal.

Esta simulação, portanto, exemplifica uma aplicação prática do sistema 
proposto.

\subparagraph{Doente com um familiar}

Roberto é autônomo, trabalha em casa consertando televisores e mora com sua
filha de 16 anos. Apesar do constante contato com os televisores, em seu momento
de descanso, assiste aos seus programas favoritos.

Certo dia, Roberto não sente-se bem e deita-se, tendo instalado à sua televisão
o STB com as aplicações da solução proposta, ele conta com a disponibilidade de
diversas funcionalidades que podem auxiliá-lo neste momento. Poderá, por
exemplo, acessar uma das aplicação através do controle remoto, a aplicação
apresenta um conjunto de imagens na tela da televisão, cada uma exemplificando
um sintoma.  Usando o controle remoto, seleciona os sintomas que melhor
exemplificam o que está sentindo. Essa informação é processada e, em seguida, a
aplicação apresenta uma notificação contendo uma segunda opinião, informando
também a necessidade de se apresentar a um médico. É importante ressaltar que
o sistema não oferece ou indica nenhum tipo de medicamento.

É possível ainda que a aplicação sugira, em determinados casos, procedimentos a
serem realizados no paciente, momento em que a filha de Roberto teria o papel de
cuidadora informal ao realizar tais procedimentos. A aplicação guiaria o
cuidador informal em um processo passo a passo. Nesta simulação,  percebe-se a
importância de contar com um dispositivo que auxilie o cuidador e o paciente em
situações de risco à saúde.

\subparagraph{Doente com um cuidador profissional}

Dona Clélia, aposentada, contratou um cuidador profissional para acompanhar seu
marido Francisco. Infelizmente, Francisco sofre da doença de Parkinson. Por conta
do seu contrato, o cuidador fica na casa apenas nos horários da manhã e tarde e 
de sobreaviso durante a noite.

Sabendo que o casal de idosos utiliza a solução proposta neste trabalho, e sendo o
cuidador ciente das necessidades do doente, o cuidador poderá receber em seu celular ou
acompanhar através da televisão auxílio para a realização de um procedimento inerente
a um paciente com Parkinson, ou ainda, o \textit{status} das atividades diárias.

\subsection{Ambiente B} \label{subsec:ambiente-b}

O ambiente B diz respeito aos atores móveis do cenário geral. Os atores externos
são a equipe de saúde, os familiares e amigos do paciente. Estes três atores
estão em constante movimento e não visitam o doente frequentemente. Nesse
sentido, o sistema disponibiliza meios para que fiquem a par da situação do
paciente.

Estando os atores de porte de um \smartphone[] e este dispositivo conectado ao
sistema, é possível receber alertas relacionados ao paciente. Os alertas podem
envolver desde o \textit{status} atual do doente, considerações acerca do
cuidador até mensagens de cunho emergencial.

Já através da interface \web[], os atores mais beneficiados são a equipe de
saúde e os familiares, pois eles têm acesso a informações mais detalhadas do
paciente através desta forma de visualização de dados. Nesse modelo, os dados
apresentados vão desde a leitura de alguns sensores instalados na casa até a
visualização de sinais vitais do paciente.

\subsubsection{Simulações}

A simulação a seguir apresenta uma situação fictícia em que a plataforma pode
se tornar útil.

\subparagraph{Doente em situação de emergência}

Maria é dona de casa e passa suas manhãs organizando e limpando a casa. Apesar
de todo esse apreço pela casa, Maria não se cuida e, além de ser hipertensa,
esquece de tomar seu remédio em algumas ocasiões, tamanho é o seu desleixo.

Certa manhã, após preparar o almoço, Maria senta-se para assistir televisão -
que conta com o STB com a solução proposta. Passado alguns minutos, ela sente
uma forte dor no peito seguido por um desconforto no braço esquerdo. Neste
momento, Maria certa de que precisa de ajuda, pode acionar no controle remoto o
"botão de pânico". 

A aplicação percebe o acionamento e toma algumas medidas, tais como, enviar
mensagens de socorro através de SMS ou através de serviços de mensagens pela
Internet para a equipe de saúde, para os amigos e familiares.  Por fim, a
aplicação pode enviar uma notificação para ser exibida na televisão no sentido
de tranquilizar o usuário.

Além disso, os sensores médicos utilizados por Maria auxiliam os atores
externos (equipe de saúde, familiares e amigos) a tomarem as medidas
necessárias para o melhor atendimento de Maria.  Em determinados casos, é
possível, ainda, que a aplicação envie, através de notificações, sugestões de
medidas a serem tomadas enquanto o socorro médico não chega.

\subsection{Ambiente C} \label{subsec:ambiente-c}

O ambiente C aborda de forma geral os serviços oferecidos e de que forma eles se
relacionam com a parte A e B. Podemos descrever a parte C a partir de uma leitura 
\textit{top-down} da figura \ref{fig:cenarios}. No subitem X temos a plataforma
\nextsaude[], esta plataforma oferece meios de comunicação para que outros sistemas
possam se comunicar com ela, possibilitando uma integração entre vários sistemas.

Parte dessa integração é realizada através do padrão OpenEHR (subitem Y), sua 
função é permitir que sistemas informatizados de saúde, no caso a plataforma
\nextsaude[], se comunique de maneira transparente com outros sistemas de saúde ou
instâncias de sistemas de saúde, tal como a aplicação TV-Health (seção
\vref{sec:tv-health}). A utilização do OpenEHR possibilita que toda a solução
proposta se comunique, com o menor esforço possível, com outros sistemas de 
saúde.

Na última camada da pilha - no subitem Z - pautamos a Internet das Coisas ou
\textit{IoT}. A partir deste conceito será possível realizar a aquisição de
dados dos sensores médicos conectados ao paciente e sensores instalados no domicílio
(ambiente A), proporcionando um monitoramento constante dos atores envolvidos, 
o que é ideal para uma situação de internação domiciliar. Este serviço fará uso 
de tópicos apresentados na plataforma \textit{OpenIoT}
(seção \vref{sec:openiot}).

%\subsection{Simulações} \label{subsec:simulacoes}

%(\nameref{subsubsec:doente-sozinho}, \nameref{subsubsec:doente-com-familiar}
%e \nameref{subsubsec:doente-cuidador}) remetem ao \nameref{subsec:ambiente-a}.
%Já a simulação \nameref{subsubsec:doente-emergencia} remete ao \nameref{subsec:ambiente-b}.

%\subsubsection{Doente sozinho} \label{subsubsec:doente-sozinho}

%Para que Luisa não ficasse sozinha tanto tempo, seus filhos pediram à vizinha
%que checasse sua condição de tempos em tempos, fazendo com que Luisa agora tivesse uma
%espécie de cuidador informal. A função do cuidador informal seria de acompanhar
%Luisa na caminhada e recordá-la de tomar seus remédios.

%\subsubsection{Doente com um familiar} \label{subsubsec:doente-com-familiar}
%\subsubsection{Doente com um cuidador profissional} \label{subsubsec:doente-cuidador}
%\subsubsection{Doente em situação de emergência} \label{subsubsec:doente-emergencia}

\section{Descrição da solução}
\label{sec:descricao-solucao}

A arquitetura proposta nesta seção tem como uma das bases, a plataforma OpenIoT
(descrita na seção \vref{sec:openiot}). Levando em consideração a divisão da
arquitetura nas 3 grandes camadas ``Plano Físico'', ``Plano Virtualizado'' e
``Plano de Utilitários e Aplicativos'', re-estruturamos para suprir a
necessidade específica do trabalho. Uma arquitetura que atenda a ambientes de
assistência domiciliar à saúde e que tenha em sua estrutura, espaço para a
tecnologia IoT.

Considerando a figura \ref{fig:arquitetura-openiot-2}, separamos o Plano físico -
que é composto principalmente pelo módulo \textit{Global Sensor Network} -
em 2 blocos e uma camada de nome ``Aquisição de dados'' (1) (figura
\ref{fig:arquitetura-passo1}). Esta camada caracteriza toda a parte de baixo
nível da arquitetura. Fazem parte dela os sensores médicos, sensores gerais, o
\stb[] e suas aplicações embarcadas. A comunicação entre esses dois blocos
dar-se através da rede WiFi diponibilizada na residência, Bluetooth ou NFC. Os
dados adquiridos são persistidos no STB. Caso seja necessário, alguns desses
dados são repassados adiante para posterior processamento. 

\figurasimples{arquitetura-passo1}{Simplificação da arquitetura OpenIoT - Plano Físico}{10cm}

Considerando ainda a figura \ref{fig:arquitetura-openiot-2}, separamos o Plano
Virtualizado em 3 blocos e 3 camadas distintas, como pode ser visto na figura
\ref{fig:arquitetura-passo2}). 

A ``Camada de inteligência local'' (2) não tem representante equivalente na
arquitetura OpenIoT e podemos relacioná-la tanto com o Plano Físico, quanto com
o Plano Virtualizado, uma vez que ela encontra-se logicamente no dispositivo
STB mas tem características próprias dos módulos do Plano Virtualizado, 
fazendo com que as aplicações embarcadas tenham capacidade de inferir sobre
determinadas situações. Dados provenientes dos sensores e que são úteis para a
conclusão de um fato são utilizados como entrada para domínios de conhecimento
na forma de ontologias. O próprio STB, portanto, pode decidir em eventuais
situações, fornecendo uma resposta rápida e evitando assim, tráfego de dados
desnecessário através da Internet.

Já a ``Camada de inteligência remota'' (3) baseia-se no Plano Virtualizado que
é composto pelos módulos ``Scheduler'', ``Linked Stream Middleware'' e ``Service
Delivery and Utility Manager''. A camada tem como função recuperar os dados
adquiridos pelos sensores e processá-los através de classificadores,
estendendo, assim, a camada de número 2. Ao transmitir dados do ambiente
domiciliar para um sistema na nuvem, a solução incorpora o poder de
processamento disponibilizado por essa abordagem. Além de realizar inferências
através de ontologias, podemos preparar os dados para inteligência artificial
por meio de aprendizagem de máquinas, aumentando o poder de inferência do
sistema.

A ``Camada de gerência de dados'' (4), foi extraída do Plano Virtualizado e do
Plano de utilitários e aplicativos. Ela trata os dados gerenciais, aqueles
referentes ao paciente e a logística de um atendimento especializado em
domicílio, podendo ainda, realizar a integração com o ambiente hospitalar, caso
seja necessário uma transferência do doente. A plataforma \nextsaude[],
projeto financiado pela Fundação Cearense de Apoio ao Desenvolvimento Científico 
(FUNCAP) e liderado pelo Laboratório de Redes de Computadores de Aracati (LAR) 
é utilizada nesta camada para prover os serviços necessários, tais como, o 
Registro Eletrônico de Saúde (RES), integração com áreas hospitalares, farmácias etc.

\figurasimples{arquitetura-passo2}{Simplificação da arquitetura OpenIoT - Plano Virtualizado}{10cm}

Por fim, a ``Camada de apresentação'' (5) é referente ao Plano de utilitários e
aplicativos, porém, diferente da plataforma OpenIoT, esta camada se estende por
toda a arquitetura, uma vez que a visualização de dados está presente em todas 
as camadas. Sendo assim, é possível que os diversos atores interajam por meio de
\smartphones, computadores e a tela da televisão na casa do doente.
A camada, portanto, se encarrega de apresentar os dados brutos ou as informações
processadas nos dispositivos conectados à plataforma. 

\figurasimples{arquitetura-passo3}{Simplificação da arquitetura OpenIoT - Plano de Utilitários e Aplicações}{10cm}

A arquitetura, portanto, é composta de 5 camadas distintas mas que se comunicam
entre si. As camadas descritas anteriormente, (1) ``Camada de aquisição de
dados'' responsável por adquirir os dados brutos dos sensores, (2) ``Camada de
Inteligência local'' responsável por inferir sob os dados acquisitados ainda no
STB, (3) ``Camada de Inteligência na nuvem'', responsável por realizar
inferências que não podiam ser realizadas localmente, (4) ``Camada de Gerência
de dados'', responsável por gerenciar parte dos dados coletados no ambiente
domiciliar, cruzando com dados oriundos de outros módulos da plataforma
\nextsaude[] e (5) ``Camada de Apresentação de informações'' - responsável por
apresentar os dados nos mais diversos dispositivos, são representadas na figura
\ref{fig:arquitetura-v4}.

\figurasimples{arquitetura-v4}{Visão geral arquitetural da solução}{12cm}

\section{Visão de Engenharia} \label{sec:visao-engenharia}

A figura \ref{fig:visao-engenharia-v2} representa a visão de engenharia da arquitetura
proposta. Ela tem como ponto principal a utilização de um \stb[], quando se
conectam a ele sensores  implantados no ambiente, sensores de dispositivos como
\smartphones[] e  \smartwatches[] do paciente e do cuidador, e sensores médicos
do doente.

\figurasimples{visao-engenharia-v2}{Visão de engenharia da arquitetura proposta.}{12cm}

Esse processo é composto de três momentos distintos, mas  interligados, no qual
o primeiro é relativo à aquisição de dados do ambiente e do paciente, e a
transmissão destes dados ao STB. O segundo diz respeito ao processamento dos
dados brutos. O terceiro momento o envio dos dados processados para a plataforma
\nextsaude[].

Neste sentido, os sensores gerais, relativos ao ambiente domiciliar, coletam
informações como  temperatura e umidade da residência, qualidade do ar e
localização do paciente ou cuidador nos cômodos. A partir desses dados é
possível dizer ao software se determinado espaço está muito quente, se a
qualidade do ar não está favorável à melhoria do paciente etc. Dados extraídos
de celulares, como a localização, também cooperam com o contexto, a exemplo da
informação proveniente do celular do cuidador que informa, à equipe médica ou
aos parentes, se este está junto ao paciente.

Já os sensores médicos têm como função principal coletar os sinais vitais do
paciente (pressão arterial, frequência cardíaca, níveis de oxigênio no sangue
etc). Em ambos os casos - sensores gerais e sensores médicos -, as informações
coletadas pelos dispositivos repassam  esses dados para o STB, seja através de
interfaces com tecnologia  \textit{Bluetooth}, \textit{NFC} ou \textit{Wi-Fi}.

Ao utilizarmos sensores com Wi-Fi, por exemplo, os dados são transferidos ao
STB utilizando um protocolo de transferência de mensagens entre máquinas, o
MQTT\footnote{O MQTT é um protocolo de transferência de mensagens de baixo
custo computacional e reside em cima da camada TCP/IP. O sistema funciona a
partir de um \textit{publish/subscriber}. Utiliza-se um concentrador como um
servidor MQTT.}.  Foi instalado no STB um servidor MQTT para gerenciar os dados
de entrada.

Para que o sistema de inferência local funcione de maneira adequada, parte dos
dados que chegam devem ser persistidos em um banco de dados local, a partir da
persistência, o STB pode tomar decisões no âmbito domiciliar, parte dos dados
referentes ao contexto deverão ser tratados e processados diretamente no
equipamento.  Já os dados referentes aos sinais vitais são enviados para
plataforma. Dessa maneira, ocorre um processamento nos dados para tomada de
decisões a nível clínico, por exemplo, indicar uma consulta na especialidade
cardiológica.

O restante de dados enviada ao STB deverá então ser processada e encaminhada
para a plataforma \nextsaude[] e para a camada de inferência remota.  O
processamento é referente ao tratamento do dado bruto recebido e a tradução
para o padrão OpenEHR entendido pela plataforma \nextsaude[]. Em seguida a
transmissão dos dados é feita através de uma arquitetura  cliente/servidor. Já
no sistema na nuvem, o dado relacionado ao paciente é extraído e persistido.

A partir da lógica de transferência de dados e informações, persistência
dos dados, inferência local ou na nuvem, é possível a geração de alertas e
notificações para o paciente e o cuidador. Os atores locais (paciente/cuidador) 
recebem as notificações principalmente através da tela da televisão conectada ao 
STB e através do \smartphone. Os atores móveis (equipe de saúde) podem visualizar 
os dados e receber informações referentes ao paciente a partir da interface \web ou 
a partir do \smartphone.


