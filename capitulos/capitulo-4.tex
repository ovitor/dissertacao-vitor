\chapter{Proposta}\label{cap:proposta}

Neste capítulo serão abordadas as etapas que constituem a estrutura geral do
sistema de informática voltado para o atendimento de paciente no espaço domiciliar. 
Sua descrição é realizada na primeira seção. O TV-Health, parte integrante da 
solução, tem suas características apresentadas no item \ref{sec:tv-health}.

\section{Descrição de cenários}

A figura tal representa, de maneira generalista, o cenário base para a aplicação
da solução THECA. Nela podem ser verificados 3 ambientes, o ambiente A, diz
respeito ao domicílio do paciente. Já o ambiente B, diz respeito aos atores
móveis, tais como, equipe de saúde, parentes, amigos etc. O ambiente C
representa os serviços disponibilizados pela solução.

\subsection{Cenário A} \label{subsec:cenario-a}

O cenário A representa o domicílio do usuário, seus atores locais (paciente,
visitantes e cuidador e/ou parentes), os equipamentos responsáveis por 
realizar a aquisição dos dados, o \stb[] (\textit{gateway}), a televisão e outros
dispositivos capazes de apresentar dados e informações úteis para a assistência
domiciliar à saúde. 

Neste ambiente, o ator principal é o paciente, o monitoramento constante 
proporcionado pela tecnologia nos permite acompanhar com mais clareza a situação
do doente. A partir do monitoramento é possível avisar, por exemplo, à equipe
de saúde (cenário B) uma leitura de sinais vitais. Nesse sentido, é possível 
também, lembrar ao paciente, a necessidade de tomar determinado remédio em um
horário específico.

O cuidador também tem papel importante na recuperação ou no cotidiano do 
paciente. Portanto, a tecnologia inserida neste ambiente tem função de ajudar
este ator. O sistema pode enviar mensagens no intuito de auxiliar o cuidador no
que concerne ao tratamento para com o paciente ou idoso, informando como lidar
com determinada situação ou simplesmente relembrá-lo da agenda diária do 
paciente, como por exemplo, atividade física, encontro com amigos etc.

Os familiares e visitantes, figuras constantes em um ambiente domiciliar, também
podem ser informados sobre um fato novo na agenda do doente, algo inusitado ou 
ainda uma situação de urgência/emergência.

Nesse sentido, podemos inserir no ambiente domiciliar, um conjunto de
dispositivos dotados de sensores com o intuito de captar eventos no domicílio. É
possível a utilização de sistemas para captar os sinais vitais do paciente, tais
como nível de oxigênio no corpo, batimentos cardíacos, temperatura corporal etc.
Outros tipos de sensores podem ser implantados para captar informações do
ambiente, disponibilizando assim, informações de contexto para o sistema,  tais
como, ruído sonoro nos cômodos, presença dos atores no domicílio, temperatura
ambiente etc. Estas duas categorias caracterizam um  ambiente com tecnologia de
Internet das coisas (\textit{Internet of Things  - IoT}).

O STB, equipamento que tinha como principal função, o recebimento do sinal
televisivo, seu processamento e  exibição, ganha novas funcionalidades a partir
do momento em que, aumentamos seu  poder de processamento e, o conectamos à 
Internet. Os dados coletados pelos sensores são, então, repassados ao STB,
que os processa, os apresenta através da tela do televisor ou ainda através de
\smartphones[] conectados ao sistema.


\subsection{Cenário B} \label{subsec:cenario-b}

Os atores externos utilizam o sistema por meio das interfaces web, das mensagens
via celular

\section{Descrição da solução}
\label{sec:descricao-solucao}

A arquitetura proposta soluciona o problema relatado na seção  
\ref{sec:descricao-problema}. Ela é composta de 3 camadas distintas mas que
se comunicam entre sí. As camadas são, (1) ``Camada de aquisição de dados''
responsável por adquirir os dados brutos dos sensores, (2) ``Camada de Gerência 
e Inteligência'' responsável por tratar os dados e inferir e (3) ``Camada de 
Apresentação de informações'' - responsável por apresentar os dados nos mais
diversos dispositivos. A figura \ref{fig:arquitetura-v2} representa graficamente
a arquitetura proposta.

\figurasimples{arquitetura-v2}{Visão geral arquitetural da solução}{12cm}


A ``Camada de aquisição de dados'' representa toda a parte de baixo nível da
solução.

Já a ``Camada de Gerência e Inferência'' trata os dados processados na camada
de aquisição de dados, realizando inferências com modelos ontológicos e 
persistindo-os em base de dados.

Por fim, a ``Camada de apresentação'' se encarrega de apresentar os dados brutos
ou as informações processadas nos dispositivos conectados à plataforma.

\section{TV-Health} \label{sec:tv-health} 

A partir do considerado na seção \ref{sec:aspectos-tecnologicos}, surge o
protótipo TV-Health, com o intuito de resolver alguns dos problemas da
assistência domiciliar à saúde.

% \subsection{Histórico}\label{subsec:historico-tv-health}

% O Governo Brasileiro instituiu, através do decreto número 4901 de 26 de novembro
% de 2003, o Sistema Brasileiro de Televisão Digital (SBTVD) no  país. Além da
% melhoria técnica, com a troca do sinal analógico para o sinal  digital,
% promovendo, assim, melhoria na qualidade da imagem e som, a inserção  da TV
% Digital trouxe o conceito de interatividade, permitindo que o  telespectador
% saia da condição de espectador e passe a interagir com a  televisão. Além disso,
% através do decreto, o Governo tenta promover a inclusão social ao ``propiciar a
% criação de uma rede universal de educação à distância'' 
% \cite{digitaltv2015decree}.

% A proposta do SBTVD contém um forte viés social, uma vez que o Brasil conta com
% uma grande quantidade de lares com televisão que, adicionado à interatividade 
% possibilitada pela TV digital, o telespectador passa a receber um conjunto
% de novas funcionalidades através do \stb. Com isso, a população ganha novas 
% formas de acesso a serviços básicos.

% Desde então, houve estudos em diversas áreas para viabilizar tecnicamente o
% que o decreto propusera. As pesquisas apresentaram aplicações em áreas diversas
% como educação e serviços do Governo (receita federal, \textit{status} de benefícios
% etc) e área da saúde. Por conta dessa  abordagem, foi incluído no projeto
% NextSaúde, um conjunto de aplicações voltada para o atendimento domiciliar à
% saúde que fizesse uso da TV Digital, e de sua interatividade característica.

% Adicionado a isso, surgiu a possibilidade de inserção das aplicações
% descritas  na subseção \ref{subsec:aplicacoes-tv-health} nos STBs
% disponibilizados aos beneficiários do programa Bolsa Família. Porém, o sinal
% analógico não foi completamente desligado, a adesão ao núcleo da tecnologia
% desenvolvida para a interatividade não foi completamente adotada  pela indústria
% e a distribuição dos STBs para beneficiários do Bolsa Família não levou em
% consideração as aplicações desenvolvidas, por questões financeiras.

% Esse histórico é um relato do que nos levou a acreditar na força do programa
% SBTVD, em virtude de seu viés social e inovador, trazendo consigo a
% interatividade. Entretanto, a recusa dessa tecnologia por parte da indústria e 
% sua indiferença no que concerne às importantes contribuições para a sociedade, 
% nos incentivou a pesquisar novas tendências capazes de suprir com outras
% soluções e estratégias tecnológicas o atendimento domiciliar à saúde.

\subsection{\textit{Hardware} utilizado}

O \stb[] escolhido possui especificações técnicas robustas, listadas na 
tabela \ref{tab:stb-specs}. Este STB foi resultado de um projeto de pesquisa
fomentado pela Financiadora de Estudos e Projetos (FINEP) e Agência Nacional
de Energia Elétrica (ANEEL) e foi reutilizado neste trabalho por se tratar de 
uma pesquisa em que o autor participou efetivamente.

\tabela{stb-specs}{Especificação STB}{0.9}

\subsection{\textit{Software} utilizado}

Por se tratar de um sistema embarcado robusto, faz-se necessário a instalação
de programas capazes de gerenciar o \hardware[] disponível. Para tanto, o
sistema operacional escolhido foi o GNU/Linux distribuição Linaro (derivado da
distribuição Ubuntu) \textit{kernel} 3.4 portável para a arquitetura 
ARM com \textit{drivers} específicos para a plataforma desenvolvida.

\figurasimples{stb}{Camadas do sistema embarcado}{4cm}

Na camada de usuário utilizamos o \software[] \xbmc[] - um gerenciador de mídia
- como plataforma de exibição gráfica. É através dele que o usuário irá 
interagir com as aplicações desenvolvidas. Foram necessárias algumas 
modificações por conta dos objetivos específicos definidos para esta pesquisa,
e do contexto do trabalho desenvolvido. Na figura \ref{fig:tela-principal}
destaque para a tela inicial do \software[] \xbmc[] e para o menu ``Sua Saúde''.
Os outros menus representam funcionalidades padrão do \software[] em questão,
tais como acesso a mídias (imagens, vídeos e áudios) e acesso a TV Digital aberta.

Ao clicar no menu ``Sua Saúde'', acessamos a tela com os módulos desenvolvidos
para este trabalho (figura \ref{fig:tela-principal-sua-saude}). 

\figuradupla{tela-principal}{Tela principal do STB. Destaque para o menu
``Sua Saúde''}{tela-principal-sua-saude}{Tela principal do menu ``Sua Saúde''}

\subsection{Aplicações interativas} \label{subsec:aplicacoes-tv-health}

O intuito das aplicações é melhorar a comunicação entre o doente e cuidador com
a equipe médica e seus parentes, além de permitir que o usuário utilize o
controle remoto como um ``botão de pânico''. Por fim, um dos módulos da
aplicação permite ao usuário escolher dentre os sintomas, aqueles que mais
caracterizam a sua situação e obter uma resposta do sistema relacionada às
escolhas. As aplicações  propostas foram validadas através da conclusão do
projeto NextSaúde e da aprovação de artigos acadêmicos apresentados em
Congressos.

Nossa solução foi projetada para atender aos requisitos que uma plataforma
embarcada com essas características demanda. Apesar das especificações do
\hardware[], o desenvolvimento foi encaminhado para obtermos um \software[]
simples em consumo de recursos.

\subsubsection{Módulo \textit{service.notification}}\label{subsubsec:notification}

Este módulo é responsável por apresentar na tela da televisão as notificações e
alertas recebidos no STB. Existem dois tipos de exibição de mensagens, a
primeira delas, denominada ``caixa de diálogo'', aparece no meio da tela,
ocupando boa parte da mesma. Esse tipo de notificação é utilizada quando é
necessário tirar a atenção do usuário da programação televisiva e passar a
atenção para a mensagem exibida. Mensagens importantes e de cunho emergencial
podem utilizar esse tipo de notificação.   

\figuradupla{notification-2}{Notificação do tipo \textit{pop-up}}
{notification-1}{Notificação do tipo caixa de diálogo}

O segundo tipo de notificação é denominada de \textit{pop-up}, com esse modelo,
a mensagem é exibida no canto superior direito da tela, fazendo com que a
atenção do usuário não seja totalmente requerida. Mensagens de cunho informativo
podem utilizar esse tipo de notificação. As figuras \ref{fig:notification-2} e
\ref{fig:notification-1}  mostram as duas possibilidades em ação.

\subsubsection{Módulo \textit{service.dado}}\label{subsubsec:dado}

O funcionamento deste módulo baseia-se no acionamento da aplicação através
do controle remoto do \stb[] e a interação através de suas telas no televisor
do usuário. O módulo apresenta uma tela inicial como a apresentada na 
figura \ref{fig:tela-principal-dado}.

A partir da tela principal da aplicação, o usuário que se sente mal escolhe, 
dentre um conjunto de sintomas, aqueles que representam o seu estado atual. Em
seguida, esses sintomas são enviados através de um \webservice[] para um
módulo de inferência. A conclusão é retornada para o STB, que a processa e 
apresenta para o usuário.

% \figurasimples{tela-principal-dado}
% {Tela principal do módulo \textit{service.dado}}{14cm}

\subsubsection{Módulo \textit{service.panicbutton}}\label{subsubsec:panicbutton}

O módulo \textit{service.panicbutton} tem como objetivo, permitir que o usuário
utilize o controle remoto para reportar um momento que precisa de ajuda 
emergencial. Ao acionar a tecla reservada para tal função, o sistema percebe e
prepara um conjunto de tarefas a serem executadas. Dentre elas, o envio de 
mensagens via (1) Serviço de Mensagem Simples (SMS) e (2) serviços de comunicação
pela Internet (como por exemplo o aplicativo \textit{Telegram}) para parentes, 
amigos, cuidador e a equipe médica que o acompanha. Além de entrar em contato
com o serviço de urgência e emergência.

Em seguida, o aplicativo exibe uma notificação na tela da televisão no intuito
de acalmá-lo. A figura \ref{fig:notificacao-botao-de-panico} exibe a mensagem 
tranquilizando o usuário.

% % \figurasimples{notificacao-botao-de-panico}
% {Mensagem na tela tranquilizando o usuário.}{14cm}

\section{Visão de Engenharia} \label{sec:visao-engenharia}

A figura \ref{fig:arquitetura} representa a visão de engenharia da arquitetura
proposta. Ela tem como ponto principal a utilização de um \stb[], quando se
conectam a ele sensores  implantados no ambiente, sensores de dispositivos como
\smartphones[] e  \smartwatches[] do paciente e do cuidador, e sensores médicos
do doente.

\figurasimples{arquitetura}{Visão de engenharia da arquitetura proposta.}{12cm}

Esse processo é composto de três momentos distintos, mas  interligados, no qual
o primeiro é relativo à aquisição de dados do ambiente e do paciente, e a
transmissão desses dados ao STB. O segundo diz respeito ao processamento dos
dados brutos. O terceiro momento o envio dos dados processados para a plataforma
NextSAÚDE.

Neste sentido, os sensores gerais, relativos ao ambiente domiciliar, coletam
informações como  temperatura e umidade da residência, qualidade do ar e
localização do paciente ou cuidador nos cômodos. A partir desses dados é
possível dizer ao software se determinado espaço está muito quente, se a
qualidade do ar não está favorável à melhoria do paciente etc. Dados extraídos
de celulares, como a localização, também cooperam com o contexto, a exemplo da
informação proveniente do celular do cuidador que informa, à equipe médica ou
aos parentes, se este está junto ao paciente.

Já os sensores médicos têm como função principal coletar os sinais vitais do
paciente (pressão arterial, frequência cardíaca, níveis de oxigênio no sangue
etc). Em ambos os casos - sensores gerais e sensores médicos -, as informações
coletadas pelos dispositivos repassam  esses dados para o STB, seja através de
interfaces com tecnologia  \textit{Bluetooth}, \textit{NFC} ou \textit{Wi-Fi}.

Essa quantidade de dados enviada ao STB deverá então ser processada e encaminhada
para a plataforma NextSaúde. O processamento é referente ao tratamento do dado
bruto recebido e a tradução para o padrão OpenEHR entendido pela plataforma
NextSaúde. Em seguida a transmissão dos dados é feita através de uma
arquitetura  cliente/servidor. Já no sistema na nuvem, o dado relacionado ao
paciente é extraído e persistido.

Para permitir ao STB tomar decisões no âmbito domiciliar, parte dos dados
referentes ao contexto são tratados e processados diretamente no equipamento.
Já os dados referentes aos sinais vitais são enviados para plataforma. Dessa 
maneira, ocorre um processamento nos dados para tomada de decisões a nível
clínico, por exemplo, indicar uma consulta na especialidade cardiológica.

Pelo exposto, uma funcionalidade importante do sistema é a geração de alertas e
notificações para o paciente e o cuidador. Os atores recebem as notificações
através da tela da televisão conectada ao STB. Para esse sistema, dois tipos de
alertas foram desenvolvidos: o tipo \textit{pop-up} e o caixa de diálogo.
Além disso, a partir das informações de contexto, o sistema pode decidir
entregar a mensagem não na tela da televisão e sim no \smartphone.

\section{Cenários de uso} \label{sec:cenarios-de-uso}

Os seguintes cenários de uso exemplificam a aplicação da tecnologia e em quais
momentos ela é mais requerida.

\subsection{Notificações}\label{subsec:notificacoes}

Luisa, aposentada, 75 anos, vive sozinha em seu apartamento, passa boa parte do
seu dia na sala de estar, lendo ou assistindo à televisão. Sua rotina muda um
pouco quando seus filhos a visitam nos finais de semana. Infelizmente, Luisa
sofre de uma doença crônica e seu médico recomenda caminhada uma vez ao dia,
durante 30 minutos. Além disso, foi prescrito à Luisa alguns medicamentos
necessários para evitar as dores - cada um deles deveria ser ingerido em
horários específicos.

Para que Luisa não ficasse sozinha tanto tempo, seus filhos pediram à vizinha
que checasse sua condição de tempos em tempos, fazendo com que Luisa agora tivesse uma
espécie de cuidador informal. A função do cuidador informal seria de acompanhar
Luisa na caminhada e recordá-la de tomar seus remédios.

Através do sistema embarcado acoplado à televisão e conectado à Internet, é
possível enviar à Luisa avisos e notificações lembrando de suas atividades
diárias - como por exemplo, a caminhada de 30 minutos recomendada pelo
médico além do medicamento a ser ingerido.

Portanto, este cenário de uso exemplifica uma aplicação prática do sistema de
notificação e alertas desenvolvido para compor o trabalho.

\subsection{DADO}\label{subsec:dado}

Roberto é autônomo e trabalha em casa consertando televisores, mora com sua
filha de 16 anos. Apesar do constante contato com os televisores, em seu momento
de descanso, assiste aos seus programas favoritos.

Certo dia, Roberto não se sente bem e se deita, tendo instalado à sua televisão
o set-top box com as aplicações tv-health, ele conta com a disponibilidade da
aplicação DADO. Em determinado momento, acessa a aplicação "Não está se sentindo
bem?" através do controle remoto, selecionando-a do menu "Sua Saúde". Através
dela, verifica um conjunto de imagens, cada uma exemplificando um sintoma.
Usando o controle remoto, seleciona os sintomas que melhor exemplificam o que
está sentindo. Essa informação é processada e, em seguida, a aplicação apresenta
uma notificação contendo uma segunda opinião, informando também a necessidade de
se apresentar à um médico.

É possível ainda que a aplicação sugira, em determinados casos, procedimentos a
serem realizados no paciente, momento em que a filha de Roberto teria o papel de
cuidadora informal ao realizar tais procedimentos. A aplicação guiaria o
cuidador informal em um processo passo a passo. Neste cenário,  percebe-se a
importância de contar com um dispositivo que auxilie o cuidador e o paciente em
situações de risco à saúde.

\subsection{Botão de Pânico}\label{subsec:botao-panico}

Maria é dona de casa e passa suas manhãs organizando e limpando a casa. Apesar
de todo esse apreço pela casa, Maria não se cuida e, além de ser hipertensa,
esquece de tomar seu remédio em algumas ocasiões, tamanho é o seu desleixo.

Certa manhã, após preparar o almoço, Maria senta-se para assistir televisão -
que conta com o set-top box com as aplicações tv-health. Passado
alguns minutos, ela sente uma forte dor no peito seguido por um desconforto no
braço esquerdo. Neste momento, Maria certa de que precisa de ajuda, aciona no
controle remoto o "botão de pânico".

A aplicação percebe o acionamento e toma algumas medidas, tais como, enviar
mensagens de socorro através de SMS ou através de serviços de mensagens pela
Internet para a equipe médica, para os amigos e familiares, além de entrar em
contato com o serviço médico de urgência. Por fim, a aplicação envia uma
notificação para ser exibida na televisão no sentido de tranquilizar o usuário.

Em determinados casos, é possível, ainda, que a aplicação envie, através de
notificações, sugestões de medidas a serem tomadas enquanto o socorro médico não
chega.
