\chapter{Aspectos de implementação}\label{cap:aspectos-de-implementacao}

Neste capítulo será abordado os aspectos de implementação. Dificuldades e as
soluções encontradas para construir o \software.

\section{TV-Health} \label{sec:tv-health} 

A partir do considerado na seção \ref{sec:aspectos-tecnologicos}, surge o
protótipo TV-Health, com o intuito de resolver alguns dos problemas da
assistência domiciliar à saúde.

% \subsection{Histórico}\label{subsec:historico-tv-health}

% O Governo Brasileiro instituiu, através do decreto número 4901 de 26 de novembro
% de 2003, o Sistema Brasileiro de Televisão Digital (SBTVD) no  país. Além da
% melhoria técnica, com a troca do sinal analógico para o sinal  digital,
% promovendo, assim, melhoria na qualidade da imagem e som, a inserção  da TV
% Digital trouxe o conceito de interatividade, permitindo que o  telespectador
% saia da condição de espectador e passe a interagir com a  televisão. Além disso,
% através do decreto, o Governo tenta promover a inclusão social ao ``propiciar a
% criação de uma rede universal de educação à distância'' 
% \cite{digitaltv2015decree}.

% A proposta do SBTVD contém um forte viés social, uma vez que o Brasil conta com
% uma grande quantidade de lares com televisão que, adicionado à interatividade 
% possibilitada pela TV digital, o telespectador passa a receber um conjunto
% de novas funcionalidades através do \stb. Com isso, a população ganha novas 
% formas de acesso a serviços básicos.

% Desde então, houve estudos em diversas áreas para viabilizar tecnicamente o
% que o decreto propusera. As pesquisas apresentaram aplicações em áreas diversas
% como educação e serviços do Governo (receita federal, \textit{status} de benefícios
% etc) e área da saúde. Por conta dessa  abordagem, foi incluído no projeto
% NextSaúde, um conjunto de aplicações voltada para o atendimento domiciliar à
% saúde que fizesse uso da TV Digital, e de sua interatividade característica.

% Adicionado a isso, surgiu a possibilidade de inserção das aplicações
% descritas  na subseção \ref{subsec:aplicacoes-tv-health} nos STBs
% disponibilizados aos beneficiários do programa Bolsa Família. Porém, o sinal
% analógico não foi completamente desligado, a adesão ao núcleo da tecnologia
% desenvolvida para a interatividade não foi completamente adotada  pela indústria
% e a distribuição dos STBs para beneficiários do Bolsa Família não levou em
% consideração as aplicações desenvolvidas, por questões financeiras.

% Esse histórico é um relato do que nos levou a acreditar na força do programa
% SBTVD, em virtude de seu viés social e inovador, trazendo consigo a
% interatividade. Entretanto, a recusa dessa tecnologia por parte da indústria e 
% sua indiferença no que concerne às importantes contribuições para a sociedade, 
% nos incentivou a pesquisar novas tendências capazes de suprir com outras
% soluções e estratégias tecnológicas o atendimento domiciliar à saúde.

\subsection{\textit{Hardware} utilizado}

O \stb[] escolhido possui especificações técnicas robustas, listadas na 
tabela \ref{tab:stb-specs}. Este STB foi resultado de um projeto de pesquisa
fomentado pela Financiadora de Estudos e Projetos (FINEP) e Agência Nacional
de Energia Elétrica (ANEEL) e foi reutilizado neste trabalho por se tratar de 
uma pesquisa em que o autor participou efetivamente.

\tabela{stb-specs}{Especificação STB}{0.9}

\subsection{\textit{Software} utilizado}

Por se tratar de um sistema embarcado robusto, faz-se necessário a instalação
de programas capazes de gerenciar o \hardware[] disponível. Para tanto, o
sistema operacional escolhido foi o GNU/Linux distribuição Linaro (derivado da
distribuição Ubuntu) \textit{kernel} 3.4 portável para a arquitetura 
ARM com \textit{drivers} específicos para a plataforma desenvolvida.

\figurasimples{stb}{Camadas do sistema embarcado}{4cm}

Na camada de usuário utilizamos o \software[] \xbmc[] - um gerenciador de mídia
- como plataforma de exibição gráfica. É através dele que o usuário irá 
interagir com as aplicações desenvolvidas. Foram necessárias algumas 
modificações por conta dos objetivos específicos definidos para esta pesquisa,
e do contexto do trabalho desenvolvido. Na figura \ref{fig:tela-principal}
destaque para a tela inicial do \software[] \xbmc[] e para o menu ``Sua Saúde''.
Os outros menus representam funcionalidades padrão do \software[] em questão,
tais como acesso a mídias (imagens, vídeos e áudios) e acesso a TV Digital aberta.

Ao clicar no menu ``Sua Saúde'', acessamos a tela com os módulos desenvolvidos
para este trabalho (figura \ref{fig:tela-principal-sua-saude}). 

\figuradupla{tela-principal}{Tela principal do STB. Destaque para o menu
``Sua Saúde''}{tela-principal-sua-saude}{Tela principal do menu ``Sua Saúde''}

\subsection{Aplicações interativas} \label{subsec:aplicacoes-tv-health}

O intuito das aplicações é melhorar a comunicação entre o doente e cuidador com
a equipe médica e seus parentes, além de permitir que o usuário utilize o
controle remoto como um ``botão de pânico''. Por fim, um dos módulos da
aplicação permite ao usuário escolher dentre os sintomas, aqueles que mais
caracterizam a sua situação e obter uma resposta do sistema relacionada às
escolhas. As aplicações  propostas foram validadas através da conclusão do
projeto NextSaúde e da aprovação de artigos acadêmicos apresentados em
Congressos.

Nossa solução foi projetada para atender aos requisitos que uma plataforma
embarcada com essas características demanda. Apesar das especificações do
\hardware[], o desenvolvimento foi encaminhado para obtermos um \software[]
simples em consumo de recursos.

\subsubsection{Módulo \textit{service.notification}}\label{subsubsec:notification}

Este módulo é responsável por apresentar na tela da televisão as notificações e
alertas recebidos no STB. Existem dois tipos de exibição de mensagens, a
primeira delas, denominada ``caixa de diálogo'', aparece no meio da tela,
ocupando boa parte da mesma. Esse tipo de notificação é utilizada quando é
necessário tirar a atenção do usuário da programação televisiva e passar a
atenção para a mensagem exibida. Mensagens importantes e de cunho emergencial
podem utilizar esse tipo de notificação.   

\figuradupla{notification-2}{Notificação do tipo \textit{pop-up}}
{notification-1}{Notificação do tipo caixa de diálogo}

O segundo tipo de notificação é denominada de \textit{pop-up}, com esse modelo,
a mensagem é exibida no canto superior direito da tela, fazendo com que a
atenção do usuário não seja totalmente requerida. Mensagens de cunho informativo
podem utilizar esse tipo de notificação. As figuras \ref{fig:notification-2} e
\ref{fig:notification-1}  mostram as duas possibilidades em ação.

\subsubsection{Módulo \textit{service.dado}}\label{subsubsec:dado}

O funcionamento deste módulo baseia-se no acionamento da aplicação através
do controle remoto do \stb[] e a interação através de suas telas no televisor
do usuário. O módulo apresenta uma tela inicial como a apresentada na 
figura \ref{fig:tela-principal-dado}.

A partir da tela principal da aplicação, o usuário que se sente mal escolhe, 
dentre um conjunto de sintomas, aqueles que representam o seu estado atual. Em
seguida, esses sintomas são enviados através de um \webservice[] para um
módulo de inferência. A conclusão é retornada para o STB, que a processa e 
apresenta para o usuário.

\section{\textit{Software} implementado}\label{sec:software-implementado}

Nossa solução foi projetada para atender aos requisitos que uma plataforma
embarcada com essas características demanda. Apesar das especificações do
\hardware[], o desenvolvimento foi encaminhado para obtermos um \software[]
simples em consumo de recursos.

As soluções foram implementadas utilizando, quando necessário, o paradigma
de programação Orientada a Objetos. O desenvolvimento procedural foi aplicado
com o intuito de realizar pequenas tarefas no sistema, tais como agendamento
de execução de tarefas, atualização das aplicações, desligamento automático etc.

Além disso, também fizemos uso de \webservices[] através da Internet, acessando
outros sistemas e complementando as funcionalidades desejadas. As linguagens
escolhidas para compor o sistema foram as linguagens \python[] e \shell.

\subsection{Módulo \textit{web}}

Foi necessária a implantação de um módulo \textit{web} para gerenciar as 
informações básicas do usuário. Neste sistema será possível cadastrar um 
paciente, seus alertas e contatos de emergência. O sistema foi desenvolvido
na linguagem \python[] e funciona na nuvem.

\subsection{Módulo \textit{service.notification}}\label{subsec:notification}

O módulo \textit{service.notification} foi desenvolvido utilizando a linguagem
\python[] e sua lógica faz com que constantemente execute um \textit{pooling} 
à aplicação em nuvem buscando por mensagens destinadas à esta instância de 
\software. Caso a pergunta tenha uma resposta negativa, o programa espera um 
tempo e refaz a requisição. Caso a resposta seja positiva, ou seja, exista 
alguma mensagem para aquele usuário, o programa faz o \download[] e agenda a
exibição. 

A resposta da requisição carrega informações pertinentes, um exemplo no formato
JSON é apresentado a seguir:

\begin{listing}[ht!]
\inputminted{json}{codigos/message.json}
\caption{Conteúdo da requisição de uma mensagem}
\label{lst:notification-json}
\end{listing}

O \software[] no STB verifica o conteúdo JSON, atentando-se para os campos 
\textit{startDateTime} e \textit{expirationDateTime} que representam quando 
iniciar a exibição da mensagem e quando não exibir mais a mensagem 
respectivamente, o tipo de notificação - se será do tipo \textit{pop-up} ou
caixa de diálogo -, a criticidade da mensagem - indicando se ela deve ser
exibida interrompendo a programação ou não e o conteúdo da mensagem. 

Após a correta leitura do conteúdo JSON, a mensagem é preparada para ser 
exibida. O código \ref{lst:notification-popup} faz uso da API do aplicativo
\xbmc[] para apresentar a mensagem no formato \textit{pop-up} representado pela
figura \ref{fig:notification-2}.

\begin{listing}[ht!]
\inputminted{python}{codigos/notification-popup.py}
\caption{Definição do método utilizado para apresentar as notificações no modo
\textit{pop-up}}
\label{lst:notification-popup}
\end{listing}

O método representado no código \ref{lst:notification-ok} faz uso de um outro 
método da API, obtendo o resultado visto na figura \ref{fig:notification-1}.

\begin{listing}[ht!]
\inputminted{python}{codigos/notification-ok.py}
\caption{Definição do método utilizado para apresentar as notificações no modo
ok}
\label{lst:notification-ok}
\end{listing}

A mensagem será exibida na tela de acordo com o tipo de notificação escolhida. O
tipo caixa de diálogo ocupa o centro da tela e tem um tamanho considerado, o 
intuito é tomar a atenção do usuário para a mensagem a ser exibida, já o tipo
\textit{pop-up} aparece no canto superior da tela - sendo esta a mais discreta 
das duas. Veja nas figuras \ref{fig:notification-2} e \ref{fig:notification-1} 
as duas possibilidades em ação.

% \figuradupla{notification-2}{Notificação do tipo \textit{pop-up}}
% {notification-1}{Notificação do tipo caixa de diálogo}

\subsection{Módulo \textit{service.dado}}\label{subsec:dado}

O módulo \textit{service.dado} foi desenvolvido utilizando a linguagem 
\python[]. O usuário pode iniciar a aplicação através do menu ``Sua Saúde''
(figura \ref{fig:tela-principal}) e em seguida escolher a opção ``Não está se 
sentindo bem?'' (figura \ref{fig:tela-principal-sua-saude}) no \stb[] através do 
controle remoto. O módulo apresenta uma tela inicial como a apresentada na 
figura \ref{fig:tela-principal-dado}.

O funcionamento deste módulo baseia-se no acionamento da aplicação através
do controle remoto do \stb[] e a interação através de suas telas no televisor
do usuário. 

% \figurasimples{tela-principal-dado}
% {Tela principal do módulo \textit{service.dado}}{12cm}

A partir da tela principal da aplicação, o usuário que se sente mal escolhe 
dentre um conjunto de sintomas, àqueles que representam o seu estado atual. Em
seguida, esses sintomas são enviados através de um \webservice[] para um
módulo de inferência. A conclusão é retornada para o STB, que a processa e 
apresenta para o usuário.

\subsection{Módulo \textit{service.panicbutton}}\label{subsec:panicbutton}